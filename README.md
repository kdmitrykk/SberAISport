# SberAISport

# Анализ позы спортсмена с помощью MediaPipe

## Задачи проекта
1. Изучение неразмеченного датасета спортивных видео
2. Разработка пайплайна для детекции спортсмена с использованием MediaPipe
3. Вычисление метрик стабильности, плавности движений и аномалий
4. Сравнение производительности с моделями семейства YOLO

## Обзор модели MediaPipe
**Архитектура:**
- Основана на **BlazePose** - легковесной CNN, оптимизированной для работы в реальном времени
- Определяет **33 ключевые точки тела** (лицо, руки, туловище, ноги)

**Выходные данные:**
- 3D-координаты (x, y, z) и показатель видимости для каждой точки
- Углы между суставами
- Визуализация скелета (POSE_CONNECTIONS)

**Преимущества:**
- Высокая производительность: 30+ FPS на CPU
- Минимальные требования к ресурсам
- Устойчивость к сложным условиям:
  - Перекрытиям (self-occlusion)
  - Частичной видимости тела
  - Дрожанию точек (фильтр Калмана)

## Архитектура решения
1. Загрузка видеоархива
2. Установка зависимостей (MediaPipe, OpenCV, NumPy)
3. Инициализация модели позы
4. Обработка видео и трекинг ключевых точек
5. Расчет метрик и визуализация результатов

```python
def init_detector():
    mp_pose = mp.solutions.pose
    pose = mp_pose.Pose(static_image_mode=False,
                        model_complexity=1,
                        min_detection_confidence=0.5)
    return pose, mp_pose
```

## Метрики анализа
Из-за отсутствия размеченных данных (ground truth) традиционные метрики (MAE, MSE, precision, recall) не использовались. Вместо этого применялись:

1. **Стабильность позы**: Средняя дисперсия координат ключевых точек по времени
2. **Плавность движений**: Среднее ускорение ключевых точек
3. **Время инференса**: Среднее время обработки кадра (мс)
4. **Аномальные кадры**: Количество кадров со скачками позы > (mean + 2*std)

```python
# Расчет метрик
x_var = np.var(points[:, :, 0], axis=0)
y_var = np.var(points[:, :, 1], axis=0)
pose_stability = float(np.mean(x_var + y_var))

vel = np.diff(points, axis=0)
acc = np.diff(vel, axis=0)
smoothness = float(np.mean(np.linalg.norm(acc, axis=2)))
```

## Результаты работы MediaPipe

| Видео                          | Стабильность | Плавность | Время (мс) | Аномалии |
|--------------------------------|--------------|-----------|------------|----------|
| 0LtLS9wROrk_E_000731_000738.mp4| 122832       | 107.97    | 40.8       | 19       |


## Сравнение с моделями YOLO
| Модель       | Стабильность | Плавность | Время (мс) | Аномалии |
|--------------|--------------|-----------|------------|----------|
| **MediaPipe**| 122832       | 107.97    | 40.8       | 19       |
| YOLOv8n-pose | 138370       | 233.9     | 168.2      | 17       |
| YOLOv8s-pose | 109765       | 219.92    | 449.4      | 18       |
| YOLOv8m-pose | 142934       | 225.79    | 1056.8     | 22       |

**Выводы:**
- MediaPipe показал лучшее время инференса (в 4-26 раз быстрее YOLO)
- YOLO-модели демонстрируют сравнимую стабильность позы
- Количество детектируемых аномалий сопоставимо между моделями


## Установка
Установите зависимости:
```bash
pip install ultralytics mediapipe opencv-python numpy matplotlib
```


## Заключение
Разработанное решение позволяет анализировать позу спортсмена в реальном времени с использованием легковесной модели MediaPipe. Несмотря на отсутствие размеченных данных, предложенный набор метрик позволяет оценивать стабильность и плавность движений. MediaPipe показал значительное преимущество в скорости работы по сравнению с моделями семейства YOLO, что делает его предпочтительным выбором для систем реального времени.

## Автор
Крикунов Дмитрий Геннадьевич
